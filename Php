.build:
  stage: build
  image:
    name: registry.dev.sbiepay.sbi:8443/ubi9/php-8.2:v1
    pull_policy: always

  script:
    - pwd
    - ls -la

    - |
      if [ -n "$VERSION" ]; then
        echo "Version is $VERSION"
        echo "$VERSION" > VERSION.txt
      else
        echo "No version provided"
      fi

    # Install dependencies
    - |
      if [ -f composer.json ]; then
        composer install --no-interaction --prefer-dist --no-progress
      else
        echo "composer.json not found, skipping composer install"
      fi

    # Optional test step
    - |
      if [ -f vendor/bin/phpunit ]; then
        vendor/bin/phpunit
      else
        echo "PHPUnit not found, skipping tests"
      fi

    # Package build output
    - mkdir -p build
    - cp -r . build/

    - ls -lrth build

  artifacts:
    paths:
      - build/
    when: on_success
    expire_in: 1 week
