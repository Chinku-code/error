FROM registry.dev.sbiepay.sbi:8443/spark/sparkrecon:4.0.0_12092025v43

WORKDIR /app

# Spark artifact dir (avoid permission issues)
ENV SPARK_SUBMIT_OPTS="-Dspark.sql.artifact.dir=/tmp/spark-artifacts"

# Create ONLY app directories (do NOT chmod /tmp)
RUN mkdir -p /app/input_files /app/output_files /tmp/spark-artifacts \
    && chmod -R 777 /app

# Copy application JAR
COPY spring-context-spark-1.0.jar /app/app.jar

ENTRYPOINT ["spark-submit"]
CMD ["/app/app.jar"]
